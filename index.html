<!DOCTYPE html>

<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>helpcheck</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="top-section">
    <img src="helpcheck.png" alt="helpcheck Logo" style="height:35px; padding-top: 40px; padding-bottom: 25px;">
    <p style="max-width: 500px; text-align: center; margin: 0 auto;">If you're not sure if a message is really from the government and if it's safe to click a provided link, we're here to help.</p>
</div>


<div class="input-section">
    <!-- Step 1: Decide to use text input or upload image -->
    <p>Choose one of the following options:</p>
   
    <input type="radio" id="imageInputOption" name="inputOption" checked>
    <label for="imageInputOption">Upload Screenshot</label>
    <br>
    <input type="radio" id="textInputOption" name="inputOption">
    <label for="textInputOption">Insert Text</label>
	
    <!-- Step 2a: Image upload -->
    <div id="imageInputSection">
        <br>
        <input type="file" id="fileInput">
        <br>
        <br>
        <button onclick="analyzeImage()">Scan Image</button>
        <br>
        <div id="imageAndText" style="display:none;">
            <br>
            <h6>Uploaded image:</h6>
            <img id="uploadedImage" src="" alt="Uploaded Image" style="max-width: 300px; margin-bottom: 10px;">
            <br>
            <h6>Message detected in image:</h6>
            <div id="extractedText" class="text-box"></div></div>
            <br>
        </div>
    </div>

	
    <!-- Step 2b: Text input -->
    <div id="textInputSection" style="display:none;">
        <p>Paste message below:</p>
        <textarea id="inputText" rows="10" cols="40"></textarea>
    </div>

    <!-- Step 3: Check button -->
    <br><button id="checkButton" onclick="checkInput()" style="display: none; margin: 0 auto;">Check Message</button>
<br><br>

</div>

<div class="results-section"> 

    <!-- Step 4: Results -->
    <h2 id="resultsHeader" style="display:none;">Results</h2>
    
    <div class="result-box" id="verifiedResultBox">
        <h3>Safe to click</h3>
        <h5 id="verifiedResult"></p2>
    </div>

    <div class="result-box" id="unverifiedResultBox">
        <h3>Not safe to click</h3>
        <h5 id="unverifiedResult"></p2>
    </div>

    <div class="result-box" id="noLinksResultBox"> <!-- Added result box for message without links -->
        <h5 id="noLinksResult"></p2>
    </div>

<div class="footer-section">
    Helpcheck is in the developmental phase.<br>Please share your thoughts with us at helpchecksg@gmail.com.
</div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js"></script>
    
	<script>
    // Step 1: Decide to use text input or upload image
    var textInputOption = document.getElementById("textInputOption");
    var imageInputOption = document.getElementById("imageInputOption");
    var textInputSection = document.getElementById("textInputSection");
    var imageInputSection = document.getElementById("imageInputSection");
    var checkButton = document.getElementById("checkButton");

    // Function to handle when the image input option is selected
    function handleImageInput() {
        textInputSection.style.display = "none";
        imageInputSection.style.display = "block";
        clearResults(); // Clear results when switching to image input
        hideImageAndText(); // Hide uploaded image and extracted text
        clearImageInput(); // Clear uploaded image
        checkButton.style.display = "none"; // Hide the Check button for image input
    }

    // Function to handle when the text input option is selected
    function handleTextInput() {
        textInputSection.style.display = "block";
        imageInputSection.style.display = "none";
        clearResults(); // Clear results when switching to text input
        hideImageAndText(); // Hide uploaded image and extracted text
        checkButton.style.display = "inline-block"; // Show the Check button for text input
    }

    // Function to clear uploaded image input
    function clearImageInput() {
        var fileInput = document.getElementById('fileInput');
        fileInput.value = ""; // Clear file input value
    }

    // Function to clear results
    function clearResults() {
        var uploadedImage = document.getElementById("uploadedImage");
        var extractedText = document.getElementById("extractedText");
        uploadedImage.src = ""; // Clear the uploaded image
        extractedText.textContent = ""; // Clear the extracted text
    }

    // Function to hide uploaded image and extracted text
    function hideImageAndText() {
        var imageAndText = document.getElementById("imageAndText");
        var resultsHeader = document.getElementById("resultsHeader");
        imageAndText.style.display = "none";
        resultsHeader.style.display = "none";
    }

    // Initially, set the image input option as default
    handleImageInput();

    // Add event listeners
    textInputOption.addEventListener("change", handleTextInput);
    imageInputOption.addEventListener("change", handleImageInput);

// Function to reset the interface
    function resetInterface() {
        clearResults();
        hideImageAndText();
        checkButton.style.display = "none"; // Hide the Check button
    }

    // Add event listener to the "Choose File" button
    document.getElementById('fileInput').addEventListener('click', resetInterface);

    // Function to analyze the uploaded image
function analyzeImage() {
    var fileInput = document.getElementById('fileInput');
    if (fileInput.files.length > 0) {
        var file = fileInput.files[0];
        var reader = new FileReader();
        reader.onload = function() {
            var dataUrl = reader.result;
            // Clear previous results and reset interface
            clearResults();
            hideImageAndText();
            // Display new image and start analysis
            displayImageAndText(dataUrl);
            checkButton.style.display = "inline-block"; // Show the Check button after analyzing image
        }
        reader.readAsDataURL(file);
    } else {
        alert('Please upload an image.');
    }
}

    // Function to display the uploaded image and extracted text
    function displayImageAndText(dataUrl) {
        var imageAndText = document.getElementById("imageAndText");
        var uploadedImage = document.getElementById("uploadedImage");
        var extractedText = document.getElementById("extractedText");

        imageAndText.style.display = "block"; // Display the image and extracted text
        uploadedImage.src = dataUrl;
        extractedText.textContent = ""; // Clear the extracted text

        // Process the uploaded image to extract text
        processImage(dataUrl);
    }

    // Function to process the uploaded image to extract text
    async function processImage(dataUrl) {
        Tesseract.recognize(
            dataUrl,
            'eng',
            { logger: m => console.log(m) }
        ).then(({ data: { text } }) => {
            displayExtractedText(text);
        }).catch(error => {
            console.error('Error during text recognition:', error);
        });
    }

    // Function to display the extracted text
    function displayExtractedText(text) {
        var extractedText = document.getElementById("extractedText");
        extractedText.textContent = text.trim();
    }

        async function checkInput() {
            if (textInputOption.checked) {
                var inputText = document.getElementById("inputText").value.trim();
                analyzeText(inputText);
            } else {
                var extractedText = document.getElementById("extractedText").textContent.trim();
                analyzeText(extractedText);
            }
        }

        async function analyzeText(text) {
            var urls = extractUrls(text);

            // Display Results header
            var resultsHeader = document.getElementById("resultsHeader");
            resultsHeader.style.display = "block";

            // Analyze URLs
            var govSGUrls = [];
            var otherUrls = [];
            for (const url of urls) {
                if (isGovSGUrl(url)) {
                    govSGUrls.push(url);
                } else {
                    otherUrls.push(url);
                }
            }

            // Display Analysis Results
            var verifiedResultBox = document.getElementById("verifiedResultBox");
            var unverifiedResultBox = document.getElementById("unverifiedResultBox");
            var noLinksResultBox = document.getElementById("noLinksResultBox"); // Added line
            var verifiedResult = document.getElementById("verifiedResult");
            var unverifiedResult = document.getElementById("unverifiedResult");
            var noLinksResult = document.getElementById("noLinksResult"); // Added line

            if (govSGUrls.length > 0) {
                verifiedResult.innerHTML = (govSGUrls.length === 1 ?
                    "The message contains 1 link directing to a Government website or a website that has undergone review by a government official. Click on the link to access the website.<br><br>" +
                    "<a href='" + govSGUrls[0] + "' target='_blank'>" + govSGUrls[0] + "</a>" :
                    "The message contains " + govSGUrls.length + " " + (govSGUrls.length !== 1 ? "links" : "link") + " directing to a Government website or a website that has undergone review by a government official" + (govSGUrls.length !== 1 ? "s" : "") + ". Click on the links to access the websites.<br><br>" +
                    govSGUrls.map(function (url, index) {
                        return (index + 1) + ". <a href='" + url + "' target='_blank'>" + url + "</a>";
                    }).join("<br>"));
                verifiedResultBox.style.display = "block";
            } else {
                verifiedResultBox.style.display = "none";
            }

            if (otherUrls.length > 0) {
                unverifiedResult.innerHTML = (otherUrls.length === 1 ?
                    "The message contains 1 unverified web link. Please be careful.<br><br>" +
                    otherUrls[0] :
                    "We have detected " + otherUrls.length + " unverified web links" + (otherUrls.length !== 1 ? "s" : "") + " in the message. Please be careful.<br><br>" +
                    otherUrls.map(function (url, index) {
                        return (index + 1) + ". " + url;
                    }).join("<br>"));
                unverifiedResultBox.style.display = "block";
            } else {
                unverifiedResultBox.style.display = "none";
            }

            if (govSGUrls.length === 0 && otherUrls.length === 0) {
                noLinksResult.textContent = "We did not find any web links in the message.";
                noLinksResultBox.style.display = "block";
            } else {
                noLinksResultBox.style.display = "none";
            }
        }

        function extractUrls(text) {
            var urlRegex = /(?:https?:\/\/)?(?:www\.)?([a-zA-Z0-9-]+(?:\.[a-zA-Z]+)+(?:\/[^\s]*)?)/g;
            return text.match(urlRegex) || [];
        }

        function isGovSGUrl(url) {
            return url.endsWith(".gov.sg") || url.includes(".gov.sg/");
        }

        function hideImageAndText() {
            var imageAndText = document.getElementById("imageAndText");
            var resultsHeader = document.getElementById("resultsHeader");
            imageAndText.style.display = "none";
            resultsHeader.style.display = "none";
        }

        function clearResults() {
            var verifiedResultBox = document.getElementById("verifiedResultBox");
            var unverifiedResultBox = document.getElementById("unverifiedResultBox");
            var noLinksResultBox = document.getElementById("noLinksResultBox"); // Added line
            verifiedResultBox.style.display = "none";
            unverifiedResultBox.style.display = "none";
            noLinksResultBox.style.display = "none"; // Added line
        }
    </script>
    

</body>
</html>
